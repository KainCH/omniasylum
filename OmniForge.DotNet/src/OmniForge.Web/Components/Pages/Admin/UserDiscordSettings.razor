@page "/admin/users/{UserId}/discord"
@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Web
@using OmniForge.Core.Entities
@using OmniForge.Core.Interfaces
@using OmniForge.Web.Components.Settings
@attribute [Authorize(Roles = "admin")]
@inject IUserRepository UserRepository

<PageTitle>Admin - Discord Settings</PageTitle>

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-discord text-primary"></i> Discord Settings</h2>
        <a href="/admin/users" class="btn btn-outline-secondary">Back to Users</a>
    </div>

    @if (isLoading)
    {
        <div class="text-center">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    }
    else if (selectedUser == null)
    {
        <div class="alert alert-danger" role="alert">
            User not found.
        </div>
    }
    else
    {
        <div class="alert alert-info">
            Managing Discord settings for <strong>@selectedUser.DisplayName</strong> (@selectedUser.Username).
        </div>

        <DiscordIntegrationSettings UserId="@UserId" ShowCancel="false" CloseOnSave="false" />
    }
</div>

@code {
    [Parameter] public string UserId { get; set; } = string.Empty;

    private bool isLoading = true;
    private User? selectedUser;

    protected override async Task OnParametersSetAsync()
    {
        isLoading = true;
        try
        {
            if (!string.IsNullOrWhiteSpace(UserId))
            {
                selectedUser = await UserRepository.GetUserAsync(UserId);
            }
        }
        finally
        {
            isLoading = false;
        }
    }
}
