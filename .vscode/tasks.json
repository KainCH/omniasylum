{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Install API Dependencies",
      "type": "shell",
      "command": "npm install",
      "options": {
        "cwd": "${workspaceFolder}/API"
      },
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      }
    },
    {
      "label": "Start API Server",
      "type": "shell",
      "command": "npm start",
      "options": {
        "cwd": "${workspaceFolder}/API"
      },
      "problemMatcher": [],
      "isBackground": true,
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "focus": false
      }
    },
    {
      "label": "Start API Server (Dev)",
      "type": "shell",
      "command": "npm run dev",
      "options": {
        "cwd": "${workspaceFolder}/API"
      },
      "problemMatcher": [],
      "isBackground": true,
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "focus": false
      }
    },
    {
      "label": "Deploy to Azure",
      "type": "shell",
      "command": "az deployment group create --resource-group ${input:resourceGroup} --template-file deploy/main.bicep --parameters baseName=${input:baseName}",
      "options": {
        "cwd": "${workspaceFolder}/API"
      },
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      }
    },
    {
      "label": "Azure Login",
      "type": "shell",
      "command": "az login",
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      }
    },
    {
      "label": "View Azure Logs",
      "type": "shell",
      "command": "az containerapp logs show --name ${input:containerAppName} --resource-group ${input:resourceGroup} --follow",
      "problemMatcher": [],
      "isBackground": true,
      "presentation": {
        "reveal": "always",
        "panel": "dedicated"
      }
    },
    {
      "label": "Fullstack Deploy",
      "type": "shell",
      "command": "powershell.exe -ExecutionPolicy Bypass -File '.\\deploy-with-cleanup.ps1'",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "shared",
        "showReuseMessage": false
      }
    },
    {
      "label": "Backend Deploy",
      "type": "shell",
      "command": "powershell.exe -ExecutionPolicy Bypass -File '.\\deploy-with-cleanup.ps1' -SkipFrontend",
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": [],
      "presentation": {
        "reveal": "always",
        "panel": "shared",
        "showReuseMessage": false
      }
    }
  ],
  "inputs": [
    {
      "id": "resourceGroup",
      "type": "promptString",
      "description": "Azure Resource Group Name",
      "default": "Streamer-Tools-RG"
    },
    {
      "id": "baseName",
      "type": "promptString",
      "description": "Base name for Azure resources",
      "default": "omniforgestream"
    },
    {
      "id": "containerAppName",
      "type": "promptString",
      "description": "Container App Name",
      "default": "omniforgestream-api"
    }
  ]
}
